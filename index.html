<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="style.css">
	<script src="https://unpkg.com/intersection-observer@0.5.1/intersection-observer.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/scrollama/3.0.4/scrollama.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.3.0/d3.min.js"></script>
	
	<title>New Haven Alleys Map</title>
  </head>

  <body>

	<!-- <div style="margin-right: 2%; width:96%;">
		<img src="Guo_Yale-Bubble.jpg" style="width: 80%; margin: 3% 10%;">
		<span>image credit: Dora Guo</span>
	</div> -->
    <div>
        <!-- <h1 id="">New Haven's Alleys, Pathways, and Thoroughfares</h1> -->
        <h1>New Haven's <br> Invisible Street Grid</h1>
        <!-- <h2>The little alleys that are more important than you think</h2> -->
        <video width="100%" autoplay loop style="position:sticky;z-index:1;">
            <source src="alley intro.mp4">
            
        </video>
        <h3>Ali Hafez</h3>
    </div>

      <section id="scrolly">

        <style>
            #quote-bubbles {
                width: 100%;
                position:absolute;
                z-index:5;
                top:-2%;
                @media only screen and (min-width: 700px) {
                    top: -13%;
                }
            }
            
            .quote-bubble {
                width: 25%;
                margin-top: 5%;
                padding: 5%;
                margin-left: 10%;

                /* height: 50%; */
                text-align: center;
                /* border-radius: 50%; */
                background-image: url("cairo_1.jpg");
                background-color: hsl(209, 62%, 75%, 50%);

                /* @media only screen and (min-width: 700px) {
                    padding: 2%;
                    margin-top: 2%;
                } */
            }
            
            .right {
                margin-left: auto;
                margin-right: 10%;
            }
        </style>

        <div id="quote-bubbles">
            <p class="quote-bubble">
                "it's quicker!"
            </p>
            <p class="quote-bubble right">
                "I just like it!"
            </p>
            <p class="quote-bubble">
                "My friends do it"
            </p>
            <p class="quote-bubble right">
                "I like the coziness"
            </p>
            <p class="quote-bubble">
                "I just like it!"
            </p>
            <p class="quote-bubble right">
                "I just like it!"
            </p>
            
        </div>

        <div class="sticky-thing">
            <img id="bgimg1" src="new_haven_road_map_1.png" width="50%">
              <!--  put something here???? -->
        </div>

        <div class="step-paragraph">
            <p style="margin-bottom: 2rem;">
                When you think about how to get around in a city, what usually comes to mind is a map of streets and 
                sidewalks forming islands -- city blocks -- of buildings, in a
                sea of car and pedestrian traffic, streets, and lanes.
                <br><br>
                But some of the most iconic and charming cities
                around the world are known for their alleyways.

                <div style="display:flex; width: 100%; justify-content: space-around;">
                    <div>
                        <img src="italy_alley.jpg" width="80%"><br>
                        Corniglia, Italy
                    </div>
                    <div>
                        <img src="cordoba_alley.jpg" width="80%"><br>
                        Cordoba, Spain
                    </div>
                    <div>
                        <img src="cairo_2.jpg" width="80%"><br>
                        Cairo, Egypt
                    </div>
                </div>
            </p>
        </div>

        <div class="scrolly-overlay">
            
            <div class="step" id="step-zero">
                <!-- <p> <span style="font-weight: bold;"> -->
                <p>
                <b>New Haven</b> is a small city, known for a lot of things — 
                (A)pizza, Yale, Elm trees — 
                but alleys are not usually one of them.
                </p>
            </div>
            
            <div class="step" id="step-one">
                <p>
                    But New Haven's alleys, while lesser-known, form an entire 
                    navigable network of <span style="font-weight: bold; color:#a93400;">invisible 
                        paths</span>, traversing and snaking through the city.
                </p>
            </div>
                
            <div class="step" id="step-two" style="padding-bottom:5rem;margin-bottom:5rem;opacity:0.1%;">
                <br>
            </div>

            <!-- <div class="step" id="step-three" >
			    <p>

                </p>
            </div> -->
        </div>

        <div class="step-paragraph">

            <p>
                Merriam-Webster defines an alley as "a walk 
                bordered by trees or bushes; a narrow street" <br><br>
                Elihu Rubin, Yale Professor of Urban Studies, describes them
                 as "an urban morphological quality" often 
                 for access to garages and trash pickup. <br><br>
            </p>
        </div>

        <div class="step-paragraph">

            <p>
                But by some metric, these places are all going to be 
                considered alleys:
                <br><br>
            </p>
        </div>


        <div class="scrolly-overlay">
            <!-- <style>
            #step-nine span,
			#step-ten span {
                text-shadow:
				-1px -1px 0 #000,
				1px -1px 0 #000,
				-1px 1px 0 #000,
				1px 1px 0 #000;
			}
            </style> -->

            <div class="step" id="step-three"> 
                <!-- Set this class to have a longer divide between this and previous, maybe swap side of map -->
                <p>Alleys take a lot of shapes -- and <br>
                    
                </p>
            </div>

            <div class="step" id="step-four"> 
                <!-- Set this class to have a longer divide between this and previous, maybe swap side of map -->
                <p>
                    <b>For example,</b>
                    <br>
                    these are all spaces I'm considering "alleys:"
                    
                    *picture* *picture* *picture*
                    <!--  -->
                </p>
            </div>
            
            <div class="step" id="step-five"> 
                <!-- Set this class to have a longer divide between this and previous, maybe swap side of map -->
                <p>
                    <b>So what do the alleys in New Haven look like?</b>
                    <br>
                    map of alleys
                </p>
            </div>


		  <div class="step" id="step-fifteen" style="margin-bottom: 100rem;"> 
			<!-- Set this class to have a longer divide between this and previous, maybe swap side of map -->
            <p>
				<!-- There are lovely places to eat and shop in <b style="color:#163b72">Westville, Wooster Square, Fair Haven, East Rock, and up Dixwell Ave.</b> <br>
				There are lovely city parks not far from campus, like <b  style="color:#163b72">Edgewood park, East Rock Park, and West Rock Park.</b><br>
				 -->

			</p>
          </div>

        </div>
      </section>

	  <hr class="center-diamond" style="margin-top:2rem;">

	  <p id="outro-paragraph" style="margin-top:0; background-color: rgba(200, 200, 200, 0.4);">
		<!-- Some people like ______, but some people are just about the nooks and crannies. -->
	  </p>

	  <!-- <img src="new-haven.png" style="width: 70%; margin: 3% 15%;"> -->

    <script>
      
    /* Scrollytelling code goes under here */

	  // Code that runs when the website loads
	  document.addEventListener("DOMContentLoaded", function(e) {
        d3.select(".sticky-thing").select("img").classed("invisible", true);
    });

		// for debugging
		///////////////
		//
		// document.addEventListener("mousemove", (e) => {
		// 	console.log("(" + e.clientX + ", " + e.clientY + ")");
		// });

		/// STEP ZERO

		//   Entering Step Zero
		d3.select("#step-zero").on('stepin',function(e) {
			// d3.select("#scrolly").style("background-color", "#bfd8d3"); // #81e8bc
			d3.select("#scrolly").style("background-color", "#96bfe6"); // #81e8bc
			// d3.selectAll("#s0_A").classed('hidden', false);

            d3.select("#bgimg1").classed("invisible", false);
            d3.select("#bgimg1").style("margin-right", "1%");
            // d3.select(".sticky-thing").style("height", false);

			// d3.select("#bgimg1").style("margin-left", (window.innerWidth > 700) ? "auto" : "0");
			// d3.select("#bgimg1").style("margin-right", (window.innerWidth > 700) ? "10%" : "auto");
			//   d3.selectAll("#s0_A").classed('hidden', true)
			// d3.select(".ai2html-container").style("transform", "scale(1.0)");
			d3.selectAll("#s1_A").classed('hidden', true); // mory's stuff
		})

		// exiting zero
		d3.select("#step-zero").on('stepout',function(e) {
			if (e.detail.direction == 'up') {
				d3.select("#campusBubble").classed('invisible', true);

				// d3.select(".sticky-thing").select("img").style("margin-right", "auto");
				d3.select("#bgimg1").classed("invisible", true);
				// d3.select("#bgimg1").attr("src", "new_haven_road_map_1.png");
				// d3.selectAll("#s0_A").classed('hidden', true);
				d3.select("#scrolly").style("background-color", "#ebd999");
				// d3.selectAll(".g-onLoad_A").classed('hidden', false);
                // d3.select(".sticky-thing").style("height", "0px");
			}
		})

		//   Entering Step One
		d3.select("#step-one").on('stepin',function(e) {
			// d3.selectAll("#s0_A").classed('hidden', true)
			// d3.selectAll("#s1_A").classed('hidden', false); // mory's stuff
			// // d3.selectAll(".g-onLoad_A").classed('hidden', true);
			// d3.selectAll("#s2_A").classed('hidden', true);
            d3.select("#bgimg1").classed("invisible", false);

			// d3.select(".ai2html-container").style("transform", "scale(5.0) translate(3%, 4%)");
		})

        d3.select("#step-two").on('stepin',function(e) {
            d3.select("#bgimg1").classed("invisible", false);
            d3.select("#scrolly").style("background-color", "#96bfe6"); // #81e8bc
        })


        d3.select("#step-two").on('stepout',function(e) {
			if (e.detail.direction == 'down') {

				// d3.select(".sticky-thing").select("img").style("margin-right", "auto");
				d3.select("#bgimg1").classed("invisible", true);
				// d3.selectAll("#s0_A").classed('hidden', true);
				d3.select("#scrolly").style("background-color", "#ebd999");
				// d3.selectAll(".g-onLoad_A").classed('hidden', false);
			}
		})

    </script>

<script>
    const scroller = scrollama();

	scroller
		.setup({
			step: "#scrolly .scrolly-overlay .step",
			offset: 0.75,
			debug: false,
      progress: true,
      threshold: 1.0,
		})
		.onStepEnter(function({ element, index, direction}) {
			const event = new CustomEvent('stepin', { detail: { direction: direction } })
			element.dispatchEvent(event);
		})
		.onStepExit(function({ element, index, direction }) {
			const event = new CustomEvent('stepout', { detail: { direction: direction } })
			element.dispatchEvent(event);
		})
    	.onStepProgress(function({ element, index, progress}) {
      		const event = new CustomEvent('stepprogress', { detail: { progress: progress } })
			element.dispatchEvent(event);
   		});

	// const scroller2 = scrollama();

	// scroller2
	// .setup({
	// 		step: "#scrolly .scrolly-overlay .step",
	// 		offset: 0.75,
	// 		debug: false,
    //   progress: true,
    //   threshold: 1,
	// 	})
	// 	.onStepEnter(function({ element, index, direction}) {
	// 		const event = new CustomEvent('stepin', { detail: { direction: direction } })
	// 		element.dispatchEvent(event);
	// 	})
	// 	.onStepExit(function({ element, index, direction }) {
	// 		const event = new CustomEvent('stepout', { detail: { direction: direction } })
	// 		element.dispatchEvent(event);
	// 	})
    // .onStepProgress(function({ element, index, progress}) {
    //   const event = new CustomEvent('stepprogress', { detail: { progress: progress } })
	// 		element.dispatchEvent(event);
    // });

	window.addEventListener("resize", scroller.resize);
    </script>


    <!-- ai2html resizer script -->

<script type="text/javascript">
  (function() {
      // only want one resizer on the page
      if (document.documentElement.className.indexOf("g-resizer-v3-init") > -1) return;
      document.documentElement.className += " g-resizer-v3-init";
      // require IE9+
      if (!("querySelector" in document)) return;
      function resizer() {
          var elements = Array.prototype.slice.call(document.querySelectorAll(".g-artboard[data-min-width]")),
              widthById = {};
          elements.forEach(function(el) {
              var parent = el.parentNode,
                  width = widthById[parent.id] || parent.getBoundingClientRect().width,
                  minwidth = el.getAttribute("data-min-width"),
                  maxwidth = el.getAttribute("data-max-width");
              widthById[parent.id] = width;

              if (+minwidth <= width && (+maxwidth >= width || maxwidth === null)) {
                  el.style.display = "block";
              } else {
                  el.style.display = "none";
              }
          });
          try {
              if (window.parent && window.parent.$) {
                  window.parent.$("body").trigger("resizedcontent", [window]);
              }
              if (window.require) {
                  require(['foundation/main'], function() {
                      require(['shared/interactive/instances/app-communicator'], function(AppCommunicator) {
                          AppCommunicator.triggerResize();
                      });
                  });
              }
          } catch(e) { console.log(e); }
      }

      document.addEventListener('DOMContentLoaded', resizer);
      // feel free to replace throttle with _.throttle, if available
      window.addEventListener('resize', throttle(resizer, 200));        

      function throttle(func, wait) {
          // from underscore.js
          var _now = Date.now || function() { return new Date().getTime(); },
              context, args, result, timeout = null, previous = 0;
          var later = function() {
              previous = _now();
              timeout = null;
              result = func.apply(context, args);
              if (!timeout) context = args = null;
          };
          return function() {
              var now = _now(), remaining = wait - (now - previous);
              context = this;
              args = arguments;
              if (remaining <= 0 || remaining > wait) {
                  if (timeout) {
                      clearTimeout(timeout);
                      timeout = null;
                  }
                  previous = now;
                  result = func.apply(context, args);
                  if (!timeout) context = args = null;
              } else if (!timeout && options.trailing !== false) {
                  timeout = setTimeout(later, remaining);
              }
              return result;
          };
      }

     
  })();
</script>

  </body>
</html>
