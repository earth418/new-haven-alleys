<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="style.css">
	<script src="https://unpkg.com/intersection-observer@0.5.1/intersection-observer.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/scrollama/3.0.4/scrollama.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.3.0/d3.min.js"></script>
	
	<title>New Haven Alleys Map</title>
  </head>

  <body>

	<!-- <div style="margin-right: 2%; width:96%;">
		<img src="Guo_Yale-Bubble.jpg" style="width: 80%; margin: 3% 10%;">
		<span>image credit: Dora Guo</span>
	</div> -->
    <div>
        <!-- <h1 id="">New Haven's Alleys, Pathways, and Thoroughfares</h1> -->
        <h1>New Haven's <br> Invisible Street Grid</h1>
        <video width="100%" autoplay loop style="position:sticky;z-index:1;">
            <source src="alley intro.mp4">
            
        </video>
        <h3>Ali Hafez</h3>
    </div>

      <section id="scrolly">

        <div class="sticky-thing">
            <img id="bgimg1" src="new_haven_road_map.png" width="50%">
              <!--  put something here???? -->
        </div>

        <div class="step-paragraph">
            <p style="margin-bottom: 2rem;">
                When you think about how to get around in a city, what usually comes to mind is a map of streets and 
                sidewalks forming islands -- city blocks -- of buildings, in a
                sea of car and pedestrian traffic, streets, and lanes.
            </p>
            <p style="text-align:center;">
                But there are more ways to get around.
            </p>
            
            <br>
        </div>
        
        <div class="scrolly-overlay">
            
            <div class="step" id="step-zero">
                <p><span style="font-weight: bold;">

                The map of New Haven you might be used to is something like this.
                </span>
                    <br><br>
                But when you include the network of secondary 
                places and thoroughfares...
                </p>
            </div>
            
            <div class="step" id="step-one">
                <p>
                    ...you get something that looks like <b>this</b>. There's an <i>entire</i> 
                    navigable network of invisible paths that traverse and snake through the city.
                </p>
            </div>
                
            <div class="step" id="step-two" style="margin-bottom:20rem;opacity:0.1%;">
                <br>
            </div>

            <!-- <div class="step" id="step-three" >
			    <p>

                </p>
            </div> -->
        </div>
        
        <div class="step-paragraph">

            <p style="margin-bottom: 2rem;">
                So how did we get something like this?
            <!-- Something like this: -->
            </p>
        
            <br>
        </div>


        <div class="scrolly-overlay">
            <style>
            #step-nine span,
			#step-ten span {
                text-shadow:
				-1px -1px 0 #000,
				1px -1px 0 #000,
				-1px 1px 0 #000,
				1px 1px 0 #000;
			}
            </style>

            <div class="step" id="step-nine"> 
                <!-- Set this class to have a longer divide between this and previous, maybe swap side of map -->
                <p><b>But waale alumni over centuries buried within. <br><br>
                    
                </p>
            </div>


		  <div class="step" id="step-fifteen" style="margin-bottom: 100rem;"> 
			<!-- Set this class to have a longer divide between this and previous, maybe swap side of map -->
            <p>
				There are lovely places to eat and shop in <b style="color:#163b72">Westville, Wooster Square, Fair Haven, East Rock, and up Dixwell Ave.</b> <br>
				There are lovely city parks not far from campus, like <b  style="color:#163b72">Edgewood park, East Rock Park, and West Rock Park.</b><br>
				

			</p>
          </div>

        </div>
      </section>

	  <hr class="center-diamond" style="margin-top:2rem;">

	  <p id="outro-paragraph" style="margin-top:0; background-color: rgba(200, 200, 200, 0.4);">
		Some people like ______, but some people are just about the nooks and crannies.
	  </p>

	  <!-- <img src="new-haven.png" style="width: 70%; margin: 3% 15%;"> -->

    <script>
      
    /* Scrollytelling code goes under here */

	  // Code that runs when the website loads
	  document.addEventListener("DOMContentLoaded", function(e) {
        d3.select(".sticky-thing").select("img").classed("invisible", true);

      	// d3.selectAll("#yaleBuildings, #yaleBubble, #s0_A, #s1_A, #s2_A,\
		//  #s3_A, #s4_A, .g-s2_A, #s6_A, #s7_A, #s11_A, #s9_A, #s10_A, #s13_A, #s15_A").classed('hidden', true);
		// 	d3.select("#campusBubble").classed('invisible', true);
		
		//  d3.selectAll("#yaleBuildings, #yaleBubble, #s0_A, #s1_A, #s2_A,\
		//  #s3_A, #s4_A, .g-s2_A, #s6_A, #s7_A, #s11_A, #s9_A, #s10_A, #s13_A, #s15_A").style('transition', 'opacity 0.5s');
		
		//  d3.selectAll("#setTo40PercentOpac1, #setTo40PercentOpac2,\
		// 	#setTo40PercentOpac3, #setTo40PercentOpac4, #setTo40PercentOpac5").style("fill-opacity", "40%");
		
		// d3.selectAll("#opac50_1, opac50_2").style("fill-opacity", "50%");
		
		// d3.selectAll(".g-onLoad_A").classed('hidden', true);
    });

		// for debugging
		///////////////
		//
		// document.addEventListener("mousemove", (e) => {
		// 	console.log("(" + e.clientX + ", " + e.clientY + ")");
		// });

		/// STEP ZERO

		//   Entering Step Zero
		d3.select("#step-zero").on('stepin',function(e) {
			// d3.select("#scrolly").style("background-color", "#bfd8d3"); // #81e8bc
			d3.select("#scrolly").style("background-color", "#96bfe6"); // #81e8bc
			d3.selectAll("#s0_A").classed('hidden', false);

            d3.select("#bgimg1").classed("invisible", false);
            d3.select("#bgimg1").style("margin-right", "10%");
            d3.select(".sticky-thing").style("height", false);

			// d3.select("#bgimg1").style("margin-left", (window.innerWidth > 700) ? "auto" : "0");
			// d3.select("#bgimg1").style("margin-right", (window.innerWidth > 700) ? "10%" : "auto");
			//   d3.selectAll("#s0_A").classed('hidden', true)
			// d3.select(".ai2html-container").style("transform", "scale(1.0)");
			d3.selectAll("#s1_A").classed('hidden', true); // mory's stuff
		})

		// exiting zero
		d3.select("#step-zero").on('stepout',function(e) {
			if (e.detail.direction == 'up') {
				d3.select("#campusBubble").classed('invisible', true);

				// d3.select(".sticky-thing").select("img").style("margin-right", "auto");
				d3.select("#bgimg1").classed("invisible", true);
				// d3.selectAll("#s0_A").classed('hidden', true);
				d3.select("#scrolly").style("background-color", "#ebd999");
				// d3.selectAll(".g-onLoad_A").classed('hidden', false);
                d3.select(".sticky-thing").style("height", "0px");
			}
		})

		//   Entering Step One
		d3.select("#step-one").on('stepin',function(e) {
			// d3.selectAll("#s0_A").classed('hidden', true)
			// d3.selectAll("#s1_A").classed('hidden', false); // mory's stuff
			// // d3.selectAll(".g-onLoad_A").classed('hidden', true);
			// d3.selectAll("#s2_A").classed('hidden', true);
            d3.select("#bgimg1").classed("invisible", false);

			// d3.select(".ai2html-container").style("transform", "scale(5.0) translate(3%, 4%)");
		})

        d3.select("#step-two").on('stepin',function(e) {
            d3.select("#bgimg1").classed("invisible", false);
        })


        d3.select("#step-two").on('stepout',function(e) {
			if (e.detail.direction == 'down') {

				// d3.select(".sticky-thing").select("img").style("margin-right", "auto");
				d3.select("#bgimg1").classed("invisible", true);
				// d3.selectAll("#s0_A").classed('hidden', true);
				d3.select("#scrolly").style("background-color", "#ebd999");
				// d3.selectAll(".g-onLoad_A").classed('hidden', false);
			}
		})

    </script>

<script>
    const scroller = scrollama();

	scroller
		.setup({
			step: "#scrolly .scrolly-overlay .step",
			offset: 0.75,
			debug: false,
      progress: true,
      threshold: 1.0,
		})
		.onStepEnter(function({ element, index, direction}) {
			const event = new CustomEvent('stepin', { detail: { direction: direction } })
			element.dispatchEvent(event);
		})
		.onStepExit(function({ element, index, direction }) {
			const event = new CustomEvent('stepout', { detail: { direction: direction } })
			element.dispatchEvent(event);
		})
    	.onStepProgress(function({ element, index, progress}) {
      		const event = new CustomEvent('stepprogress', { detail: { progress: progress } })
			element.dispatchEvent(event);
   		});

	// const scroller2 = scrollama();

	// scroller2
	// .setup({
	// 		step: "#scrolly .scrolly-overlay .step",
	// 		offset: 0.75,
	// 		debug: false,
    //   progress: true,
    //   threshold: 1,
	// 	})
	// 	.onStepEnter(function({ element, index, direction}) {
	// 		const event = new CustomEvent('stepin', { detail: { direction: direction } })
	// 		element.dispatchEvent(event);
	// 	})
	// 	.onStepExit(function({ element, index, direction }) {
	// 		const event = new CustomEvent('stepout', { detail: { direction: direction } })
	// 		element.dispatchEvent(event);
	// 	})
    // .onStepProgress(function({ element, index, progress}) {
    //   const event = new CustomEvent('stepprogress', { detail: { progress: progress } })
	// 		element.dispatchEvent(event);
    // });

	window.addEventListener("resize", scroller.resize);
    </script>


    <!-- ai2html resizer script -->

<script type="text/javascript">
  (function() {
      // only want one resizer on the page
      if (document.documentElement.className.indexOf("g-resizer-v3-init") > -1) return;
      document.documentElement.className += " g-resizer-v3-init";
      // require IE9+
      if (!("querySelector" in document)) return;
      function resizer() {
          var elements = Array.prototype.slice.call(document.querySelectorAll(".g-artboard[data-min-width]")),
              widthById = {};
          elements.forEach(function(el) {
              var parent = el.parentNode,
                  width = widthById[parent.id] || parent.getBoundingClientRect().width,
                  minwidth = el.getAttribute("data-min-width"),
                  maxwidth = el.getAttribute("data-max-width");
              widthById[parent.id] = width;

              if (+minwidth <= width && (+maxwidth >= width || maxwidth === null)) {
                  el.style.display = "block";
              } else {
                  el.style.display = "none";
              }
          });
          try {
              if (window.parent && window.parent.$) {
                  window.parent.$("body").trigger("resizedcontent", [window]);
              }
              if (window.require) {
                  require(['foundation/main'], function() {
                      require(['shared/interactive/instances/app-communicator'], function(AppCommunicator) {
                          AppCommunicator.triggerResize();
                      });
                  });
              }
          } catch(e) { console.log(e); }
      }

      document.addEventListener('DOMContentLoaded', resizer);
      // feel free to replace throttle with _.throttle, if available
      window.addEventListener('resize', throttle(resizer, 200));        

      function throttle(func, wait) {
          // from underscore.js
          var _now = Date.now || function() { return new Date().getTime(); },
              context, args, result, timeout = null, previous = 0;
          var later = function() {
              previous = _now();
              timeout = null;
              result = func.apply(context, args);
              if (!timeout) context = args = null;
          };
          return function() {
              var now = _now(), remaining = wait - (now - previous);
              context = this;
              args = arguments;
              if (remaining <= 0 || remaining > wait) {
                  if (timeout) {
                      clearTimeout(timeout);
                      timeout = null;
                  }
                  previous = now;
                  result = func.apply(context, args);
                  if (!timeout) context = args = null;
              } else if (!timeout && options.trailing !== false) {
                  timeout = setTimeout(later, remaining);
              }
              return result;
          };
      }

     
  })();
</script>

  </body>
</html>
